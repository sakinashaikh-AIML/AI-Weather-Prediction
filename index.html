<!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>üå§Ô∏è AI Weather Prediction - Real Time ML</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
        <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
        
        <style>
            * { margin: 0; padding: 0; box-sizing: border-box; }
            body { 
                font-family: 'Poppins', sans-serif; 
                background: linear-gradient(135deg, #1a2980, #26d0ce); 
                min-height: 100vh; 
                color: #fff; 
                padding: 20px; 
            }
            .container { 
                max-width: 1200px; 
                margin: 0 auto; 
                background: rgba(25, 25, 35, 0.95); 
                border-radius: 20px; 
                box-shadow: 0 20px 60px rgba(0,0,0,0.5); 
                overflow: hidden; 
            }
            header { 
                background: linear-gradient(to right, #1a1a2e, #16213e); 
                padding: 30px; 
                text-align: center; 
                border-bottom: 3px solid #00b4d8; 
            }
            .logo { 
                display: flex; 
                align-items: center; 
                justify-content: center; 
                gap: 15px; 
                margin-bottom: 10px; 
            }
            .logo i { 
                font-size: 3rem; 
                color: #00b4d8; 
            }
            h1 { 
                font-size: 2.5rem; 
                font-weight: 800; 
                background: linear-gradient(45deg, #00b4d8, #90e0ef); 
                -webkit-background-clip: text; 
                background-clip: text; 
                color: transparent; 
            }
            .subtitle { 
                font-size: 1.1rem; 
                color: #90e0ef; 
                margin-top: 5px; 
            }
            .mode-indicator { 
                padding: 10px 20px; 
                border-radius: 25px; 
                font-size: 0.9rem; 
                font-weight: 600; 
                display: inline-flex; 
                align-items: center; 
                gap: 8px; 
                margin-top: 15px; 
            }
            .mode-indicator.real { 
                background: rgba(0, 180, 216, 0.2); 
                color: #00b4d8; 
                border: 2px solid #00b4d8; 
            }
            .mode-indicator.demo { 
                background: rgba(255, 193, 7, 0.2); 
                color: #ffc107; 
                border: 2px solid #ffc107; 
            }
            .search-section { 
                padding: 30px; 
                background: rgba(30,30,40,0.8); 
                margin: 20px; 
                border-radius: 15px; 
            }
            .search-container { 
                display: flex; 
                gap: 10px; 
                margin-bottom: 20px; 
            }
            @media (max-width: 768px) { 
                .search-container { 
                    flex-direction: column; 
                } 
            }
            .search-input { 
                flex: 1; 
                padding: 15px; 
                background: rgba(255,255,255,0.05); 
                border: 2px solid rgba(0,180,216,0.3); 
                border-radius: 10px; 
                font-size: 1rem; 
                color: white; 
            }
            .search-btn { 
                background: linear-gradient(45deg, #00b4d8, #0077b6); 
                color: white; 
                border: none; 
                padding: 15px 30px; 
                border-radius: 10px; 
                font-size: 1rem; 
                cursor: pointer; 
                display: flex; 
                align-items: center; 
                gap: 10px; 
                transition: all 0.3s ease; 
            }
            .search-btn:hover { 
                background: linear-gradient(45deg, #0077b6, #00b4d8); 
                transform: translateY(-2px); 
            }
            .search-btn:disabled { 
                opacity: 0.6; 
                cursor: not-allowed; 
            }
            .quick-cities { 
                display: flex; 
                flex-wrap: wrap; 
                gap: 10px; 
                margin-top: 15px; 
            }
            .city-chip { 
                background: rgba(0,180,216,0.1); 
                color: #90e0ef; 
                padding: 10px 20px; 
                border-radius: 20px; 
                cursor: pointer; 
                transition: all 0.3s ease; 
            }
            .city-chip:hover { 
                background: rgba(0,180,216,0.2); 
                transform: translateY(-2px); 
            }
            .loading { 
                text-align: center; 
                padding: 40px; 
                display: none; 
            }
            .loader { 
                border: 5px solid rgba(255,255,255,0.1); 
                border-top: 5px solid #00b4d8; 
                border-radius: 50%; 
                width: 60px; 
                height: 60px; 
                animation: spin 1s linear infinite; 
                margin: 0 auto 20px; 
            }
            @keyframes spin { 
                0% { transform: rotate(0deg); } 
                100% { transform: rotate(360deg); } 
            }
            .error { 
                background: rgba(255,107,107,0.1); 
                border: 2px solid #ff6b6b; 
                color: white; 
                padding: 20px; 
                border-radius: 10px; 
                margin: 20px; 
                display: none; 
                align-items: center; 
                gap: 15px; 
            }
            .results { 
                display: none; 
                animation: fadeIn 0.5s ease; 
            }
            @keyframes fadeIn {
                from { opacity: 0; }
                to { opacity: 1; }
            }
            .card { 
                background: rgba(255,255,255,0.05); 
                border-radius: 15px; 
                padding: 25px; 
                margin: 20px; 
                border: 1px solid rgba(255,255,255,0.1); 
            }
            .weather-grid { 
                display: grid; 
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
                gap: 20px; 
                margin-top: 20px; 
            }
            .weather-card { 
                background: rgba(255,255,255,0.03); 
                border-radius: 10px; 
                padding: 20px; 
                text-align: center; 
                transition: transform 0.3s ease; 
            }
            .weather-card:hover { 
                transform: translateY(-5px); 
            }
            .weather-value { 
                font-size: 2.5rem; 
                font-weight: 800; 
                margin: 10px 0; 
                color: white; 
            }
            .weather-label { 
                color: #90e0ef; 
                font-size: 0.9rem; 
                text-transform: uppercase; 
                letter-spacing: 1px; 
            }
            .predictions-grid { 
                display: grid; 
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
                gap: 20px; 
                margin-top: 20px; 
            }
            .prediction-card { 
                background: linear-gradient(135deg, rgba(26,26,46,0.8), rgba(22,33,62,0.8)); 
                border-radius: 15px; 
                padding: 25px; 
                text-align: center; 
                transition: transform 0.3s ease; 
            }
            .prediction-card:hover { 
                transform: translateY(-5px); 
            }
            .prediction-value { 
                font-size: 3rem; 
                font-weight: 800; 
                margin: 15px 0; 
                color: white; 
            }
            .forecast-grid { 
                display: grid; 
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); 
                gap: 15px; 
                margin-top: 20px; 
            }
            .forecast-day { 
                background: rgba(255,255,255,0.03); 
                border-radius: 10px; 
                padding: 20px; 
                text-align: center; 
                transition: transform 0.3s ease; 
            }
            .forecast-day:hover { 
                transform: translateY(-3px); 
            }
            footer { 
                background: #1a1a2e; 
                padding: 30px; 
                text-align: center; 
                border-top: 3px solid #00b4d8; 
                margin-top: 30px; 
            }
            .info-text {
                color: #90e0ef;
                font-size: 0.9rem;
                margin-top: 10px;
                text-align: center;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <header>
                <div class="logo">
                    <i class="fas fa-cloud-sun-rain"></i>
                    <div>
                        <h1>üå§Ô∏è AI Weather Prediction</h1>
                        <p class="subtitle">Real-Time Weather Analysis with Machine Learning</p>
                    </div>
                </div>
                <div class="mode-indicator {{ 'demo' if demo_mode else 'real' }}" id="modeIndicator">
                    <i class="fas fa-{{ 'flask' if demo_mode else 'satellite' }}"></i>
                    <span>{{ 'Demo Mode' if demo_mode else 'Real-Time Data' }}</span>
                </div>
                <p class="info-text">
                    {% if demo_mode %}
                    ‚ö† Using demo data. Add your OpenWeatherMap API key for real weather data.
                    {% else %}
                    ‚úÖ Connected to OpenWeatherMap API
                    {% endif %}
                </p>
            </header>
            
            <div class="search-section">
                <h2><i class="fas fa-search-location"></i> Search City</h2>
                <div class="search-container">
                    <input type="text" class="search-input" id="cityInput" placeholder="Enter city name" value="London">
                    <button class="search-btn" id="searchBtn">
                        <i class="fas fa-bolt"></i> Get AI Prediction
                    </button>
                </div>
                <div class="quick-cities">
                    <div class="city-chip" onclick="searchCity('London')">London</div>
                    <div class="city-chip" onclick="searchCity('New York')">New York</div>
                    <div class="city-chip" onclick="searchCity('Tokyo')">Tokyo</div>
                    <div class="city-chip" onclick="searchCity('Paris')">Paris</div>
                    <div class="city-chip" onclick="searchCity('Mumbai')">Mumbai</div>
                    <div class="city-chip" onclick="searchCity('Dubai')">Dubai</div>
                </div>
            </div>
            
            <div class="loading" id="loading">
                <div class="loader"></div>
                <h3>ü§ñ AI is Analyzing Weather Data...</h3>
            </div>
            
            <div class="error" id="error">
                <i class="fas fa-exclamation-triangle"></i>
                <span id="errorText"></span>
            </div>
            
            <div class="results" id="results">
                <div class="card">
                    <h2><i class="fas fa-map-marker-alt"></i> Current Weather in <span id="currentCity">London</span></h2>
                    <div class="weather-grid">
                        <div class="weather-card">
                            <i class="fas fa-thermometer-half"></i>
                            <div class="weather-value" id="currentTemp">20¬∞C</div>
                            <div class="weather-label">Temperature</div>
                        </div>
                        <div class="weather-card">
                            <i class="fas fa-tint"></i>
                            <div class="weather-value" id="currentHumidity">65%</div>
                            <div class="weather-label">Humidity</div>
                        </div>
                        <div class="weather-card">
                            <i class="fas fa-wind"></i>
                            <div class="weather-value" id="currentWind">5.2 m/s</div>
                            <div class="weather-label">Wind Speed</div>
                        </div>
                        <div class="weather-card">
                            <i class="fas fa-cloud"></i>
                            <div class="weather-value" id="weatherDesc">‚òÄÔ∏è</div>
                            <div class="weather-label" id="weatherText">Sunny</div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h2><i class="fas fa-brain"></i> AI Predictions for Tomorrow</h2>
                    <p class="info-text">Powered by Random Forest ML Models</p>
                    <div class="predictions-grid">
                        <div class="prediction-card">
                            <div class="prediction-value" id="predTemp">21.5¬∞C</div>
                            <div class="weather-label">Temperature</div>
                            <div style="color: #90e0ef; margin-top: 10px;">ML Accuracy: <span id="tempAccuracy">92%</span></div>
                        </div>
                        <div class="prediction-card">
                            <div class="prediction-value" id="predHumidity">68%</div>
                            <div class="weather-label">Humidity</div>
                            <div style="color: #90e0ef; margin-top: 10px;">ML Accuracy: <span id="humidityAccuracy">87%</span></div>
                        </div>
                        <div class="prediction-card">
                            <div class="prediction-value" id="predRain">25%</div>
                            <div class="weather-label">Rain Probability</div>
                            <div style="color: #90e0ef; margin-top: 10px;">ML Accuracy: <span id="rainAccuracy">78%</span></div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h2><i class="fas fa-calendar-alt"></i> 5-Day Weather Forecast</h2>
                    <p class="info-text">Next 5 days weather prediction</p>
                    <div class="forecast-grid" id="forecastGrid">
                        <!-- Forecast will be loaded here -->
                    </div>
                </div>
            </div>
            
            <footer>
                <p>üå§Ô∏è Real-Time Weather AI | Powered by OpenWeatherMap & Machine Learning</p>
                <div style="margin-top: 15px;">
                    <button class="search-btn" onclick="retrainModels()" style="padding: 10px 20px; font-size: 0.9rem;">
                        <i class="fas fa-retweet"></i> Retrain ML Models
                    </button>
                    <p><b>Created and Trained by -Shaikh Sakina</b></p>
                </div>
            </footer>
        </div>

        <script>
            const cityInput = document.getElementById('cityInput');
            const searchBtn = document.getElementById('searchBtn');
            const loading = document.getElementById('loading');
            const error = document.getElementById('error');
            const errorText = document.getElementById('errorText');
            const results = document.getElementById('results');
            const modeIndicator = document.getElementById('modeIndicator');
            
            document.addEventListener('DOMContentLoaded', () => {
                getWeather('London');
                searchBtn.addEventListener('click', () => {
                    const city = cityInput.value.trim();
                    if (city) getWeather(city);
                });
                cityInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') searchBtn.click();
                });
            });
            
            async function getWeather(city) {
                loading.style.display = 'block';
                error.style.display = 'none';
                results.style.display = 'none';
                searchBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
                searchBtn.disabled = true;
                
                try {
                    const response = await fetch('/api/weather', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ city: city })
                    });
                    const data = await response.json();
                    
                    if (data.success) {
                        updateUI(data);
                    } else {
                        showError(data.error || 'Failed to get weather data');
                    }
                } catch (err) {
                    showError('Network error. Please check your connection.');
                } finally {
                    loading.style.display = 'none';
                    searchBtn.innerHTML = '<i class="fas fa-bolt"></i> Get AI Prediction';
                    searchBtn.disabled = false;
                }
            }
            
            function updateUI(data) {
                const current = data.current_weather;
                const predictions = data.predictions;
                const forecast = data.forecast || [];
                
                // Update current weather
                document.getElementById('currentCity').textContent = `${current.city}, ${current.country}`;
                document.getElementById('currentTemp').textContent = `${Math.round(current.temperature)}¬∞C`;
                document.getElementById('currentHumidity').textContent = `${Math.round(current.humidity)}%`;
                document.getElementById('currentWind').textContent = `${current.wind_speed.toFixed(1)} m/s`;
                document.getElementById('weatherDesc').textContent = getWeatherEmoji(current.description);
                document.getElementById('weatherText').textContent = current.description;
                
                // Update predictions
                if (predictions.temperature) {
                    document.getElementById('predTemp').textContent = `${Math.round(predictions.temperature)}¬∞C`;
                }
                if (predictions.humidity) {
                    document.getElementById('predHumidity').textContent = `${Math.round(predictions.humidity)}%`;
                }
                if (predictions.rain_probability) {
                    document.getElementById('predRain').textContent = `${Math.round(predictions.rain_probability)}%`;
                }
                
                // Update model accuracy
                if (data.model_accuracy) {
                    document.getElementById('tempAccuracy').textContent = `${Math.round(data.model_accuracy.temperature)}%`;
                    document.getElementById('humidityAccuracy').textContent = `${Math.round(data.model_accuracy.humidity)}%`;
                    document.getElementById('rainAccuracy').textContent = `${Math.round(data.model_accuracy.rain)}%`;
                }
                
                // Update 5-day forecast
                const forecastGrid = document.getElementById('forecastGrid');
                forecastGrid.innerHTML = '';
                
                if (forecast.length > 0) {
                    forecast.forEach(day => {
                        forecastGrid.innerHTML += `
                            <div class="forecast-day">
                                <div style="font-weight: bold; color: #00b4d8;">${day.day.substring(0,3)}</div>
                                <div style="font-size: 0.9rem; color: #90e0ef; margin-bottom: 5px;">${day.date.split('-')[2]}/${day.date.split('-')[1]}</div>
                                <div style="font-size: 2.5rem; margin: 10px 0;">${getWeatherEmoji(day.description)}</div>
                                <div style="font-size: 1.8rem; font-weight: bold; color: white;">${Math.round(day.temperature)}¬∞C</div>
                                <div style="color: #90e0ef; font-size: 0.9rem; margin-top: 8px;">
                                    <div><i class="fas fa-tint"></i> ${Math.round(day.humidity)}%</div>
                                    <div><i class="fas fa-cloud-rain"></i> ${day.rain_prob ? Math.round(day.rain_prob) : 0}%</div>
                                </div>
                                <div style="font-size: 0.8rem; color: #ccc; margin-top: 8px;">${day.description}</div>
                            </div>
                        `;
                    });
                } else {
                    forecastGrid.innerHTML = '<p style="text-align: center; color: #90e0ef;">No forecast data available</p>';
                }
                
                // Update mode indicator
                modeIndicator.className = `mode-indicator ${data.demo_mode ? 'demo' : 'real'}`;
                modeIndicator.innerHTML = `<i class="fas fa-${data.demo_mode ? 'flask' : 'satellite'}"></i><span>${data.demo_mode ? 'Demo Mode' : 'Real-Time Data'}</span>`;
                
                results.style.display = 'block';
            }
            
            function getWeatherEmoji(desc) {
                desc = desc.toLowerCase();
                if (desc.includes('clear') || desc.includes('sunny')) return '‚òÄÔ∏è';
                if (desc.includes('partly cloudy')) return '‚õÖ';
                if (desc.includes('cloud')) return '‚òÅÔ∏è';
                if (desc.includes('rain') || desc.includes('drizzle')) return 'üåßÔ∏è';
                if (desc.includes('storm') || desc.includes('thunder')) return '‚õàÔ∏è';
                if (desc.includes('snow')) return '‚ùÑÔ∏è';
                if (desc.includes('fog') || desc.includes('mist')) return 'üå´Ô∏è';
                return 'üå§Ô∏è';
            }
            
            function showError(msg) {
                errorText.textContent = msg;
                error.style.display = 'flex';
                setTimeout(() => error.style.display = 'none', 5000);
            }
            
            function searchCity(city) {
                cityInput.value = city;
                getWeather(city);
            }
            
            async function retrainModels() {
                if (!confirm('Retrain ML models? This will improve prediction accuracy but may take a minute.')) return;
                searchBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Training...';
                searchBtn.disabled = true;
                
                try {
                    const response = await fetch('/api/train', {method: 'POST'});
                    const data = await response.json();
                    if (data.success) {
                        alert(`‚úÖ ${data.message}\\nNew Accuracy: Temp=${data.accuracy.temperature}%, Humidity=${data.accuracy.humidity}%, Rain=${data.accuracy.rain}%`);
                        if (cityInput.value.trim()) getWeather(cityInput.value.trim());
                    } else {
                        alert('Error: ' + (data.error || 'Unknown error'));
                    }
                } catch (err) {
                    alert('Network error while retraining models');
                } finally {
                    searchBtn.innerHTML = '<i class="fas fa-bolt"></i> Get AI Prediction';
                    searchBtn.disabled = false;
                }
            }
        </script>
    </body>
    </html>